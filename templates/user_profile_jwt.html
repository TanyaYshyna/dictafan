<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - DiktaFun</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style_color.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/style_user_profile.css">
    
    <!-- Cropper.js –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <!-- Transformers.js –æ—Ç Hugging Face –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ -->
    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ -->
    <script type="module" id="transformers-loader">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0';
        
        // –ü–æ–¥–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è ONNX Runtime (–æ–Ω–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã)
        const originalWarn = console.warn;
        console.warn = function(...args) {
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è ONNX Runtime –æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞—Ö
            if (args[0] && typeof args[0] === 'string' && args[0].includes('CleanUnusedInitializersAndNodeArgs')) {
                return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            }
            originalWarn.apply(console, args);
        };
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫—ç—à –¥–ª—è –º–æ–¥–µ–ª–µ–π
        env.allowLocalModels = false;
        env.allowRemoteModels = true;
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
        window.pipeline = pipeline;
        window.transformers = { pipeline, env };
        
        console.log('‚úÖ Transformers.js –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ ES modules');
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
        window.dispatchEvent(new CustomEvent('transformers-ready'));
    </script>
</head>

<body>
    <div class="topbar">
        <img src="/static/icons/logo.svg" class="logo" onclick="window.location.href='/'">
        <div class="user-section" id="user-section">
            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è JavaScript -->
            <div class="username">
                <span class="user-avatar-small"></span>
                <span class="username-text"></span>
            </div>
            <div class="button-group topbar-save-group">
                <button id="saveButton" class="button-color-yellow" type="button" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" disabled>
                    <i data-lucide="save"></i>
                </button>
                <button id="exitToIndexBtn" class="button-color-yellow" type="button" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤">
                    <i data-lucide="forward"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="profile-container">
        <div class="profile-header">
            <h2>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è <span id="unsavedStar" class="unsaved-star" style="display: none;">*</span></h2>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –∞–≤–∞—Ç–∞—Ä –≤ –¥–≤—É—Ö–ø–∞–Ω–µ–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ -->
        <div class="form-section">
            <div class="profile-panels-container">
                <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ê–≤–∞—Ç–∞—Ä -->
                <div class="profile-panel avatar-panel">
                    <div class="panel-content">
                        <div class="avatar-preview">
                            <img id="avatarLarge" src="" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar-large">
                            <img id="avatarSmall" src="" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar-small">
                        </div>
                        <div class="avatar-upload">
                            <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                            <button type="button" id="avatarUploadButton" class="button-color-yellow">
                                <i data-lucide="download"></i>
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="profile-panel info-panel">
                    <div class="panel-content">
                        <div class="form-row">
                            <label for="username">–ò–º—è</label>
                            <input type="text" id="username" name="username" required>
                        </div>
                        <div class="form-row">
                            <label for="email">–ü–æ—á—Ç–∞</label>
                            <input type="email" id="email" name="email" readonly>
                        </div>
                        <div class="form-row">
                            <label for="password">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        </div>
                        <div id="languageSelectorContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ –¥–ª—è –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤ -->
        <div class="form-section">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ –¥–ª—è –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤</h3>
            <div id="userAudioSettingsContainer"></div>
        </div>

        <!-- –û—Ç—á–µ—Ç—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ) -->
        <div class="form-section">
            <h3>–û—Ç—á–µ—Ç—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é</h3>
            <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.</p>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ) -->
        <div class="form-section">
            <h3>–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∏ —É—á–∏—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.</p>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ -->
        <div id="exitModal" class="modal" style="display: none;">
            <div class="modal-content exit-modal-content">
                <h2>–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤?</h2>
                <p id="exitModalMessage">–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏?</p>
                <div class="exit-modal-buttons">
                    <button id="exitStayBtn" class="button-secondary">–û—Å—Ç–∞—Ç—å—Å—è</button>
                    <button id="exitWithoutSavingBtn" class="button-color-yellow">–í—ã–π—Ç–∏</button>
                    <button id="exitWithSavingBtn" class="button-color-green" style="display: none;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–µ–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ -->
        <div id="crop-modal" class="modal" style="display: none;">
            <div class="modal-content crop-modal-content">
                <div class="modal-header">
                    <h3>–û–±—Ä–µ–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞</h3>
                    <button class="modal-close" id="crop-close">&times;</button>
                </div>
                <div class="modal-body crop-modal-body">
                    <div class="crop-container">
                        <img id="crop-image" src="" alt="Crop">
                    </div>
                    <div class="crop-actions">
                        <button type="button" class="btn-secondary" id="crop-cancel">–û—Ç–º–µ–Ω–∞</button>
                        <button type="button" class="btn-primary" id="crop-confirm">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/lucide.js') }}"></script>

    <script id="language-data" type="application/json">
    {{ language_data | tojson | safe }}
    </script>
    <script src="{{ url_for('static', filename='js/language_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/whisper-model-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/language_selector.js') }}"></script>
    <script src="{{ url_for('static', filename='js/audio_settings_panel.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script_user_profile.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.lucide) {
                window.lucide.createIcons();
            }
            
            // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
            function checkLibraries() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º Transformers.js
                if (typeof window.pipeline !== 'undefined') {
                    console.log('‚úÖ Transformers.js –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ window.pipeline');
                } else if (typeof window.transformers !== 'undefined') {
                    console.log('‚úÖ Transformers.js –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ window.transformers');
                } else {
                    console.warn('‚ö†Ô∏è Transformers.js –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –û–∂–∏–¥–∞–µ–º...');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º WhisperModelManager
                if (window.WhisperModelManager) {
                    console.log('‚úÖ WhisperModelManager –∑–∞–≥—Ä—É–∂–µ–Ω');
                } else {
                    console.warn('‚ö†Ô∏è WhisperModelManager –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
            checkLibraries();
            
            // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Transformers.js
            window.addEventListener('transformers-ready', () => {
                console.log('üéâ Transformers.js –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!');
                checkLibraries();
            });
            
            // Fallback: –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(checkLibraries, 3000);
        });
    </script>
</body>

</html>