# üìö –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –ß—Ç–æ —Ç–∞–∫–æ–µ –º–∏–≥—Ä–∞—Ü–∏—è?

–ú–∏–≥—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π, —Ç–∞–±–ª–∏—Ü –∏ —Ç.–¥.).

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –º—ã –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ `title_translations_json` –≤ —Ç–∞–±–ª–∏—Ü—É `dictations` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤.

---

## üéØ –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

### –®–∞–≥ 1: –£–±–µ–¥–∏—Å—å, —á—Ç–æ —É —Ç–µ–±—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω `.env` —Ñ–∞–π–ª

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ `.env` –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL`:
```bash
DATABASE_URL=postgresql://user:password@host:port/database
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
python3 migrations/run_migration.py
```

–°–∫—Ä–∏–ø—Ç:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ –ë–î
- ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç SQL –º–∏–≥—Ä–∞—Ü–∏—é
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –ø–æ–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
============================================================
–ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è title_translations_json
============================================================

üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...
üìù –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏...
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!
   –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ: title_translations_json –≤ —Ç–∞–±–ª–∏—Ü—É dictations
‚úÖ –ü–æ–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ: title_translations_json (text)

‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å title_translations –≤ –∫–æ–¥–µ.
```

---

## üéØ –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Alembic (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏ Alembic (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
pip install alembic
```

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
alembic upgrade head
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Alembic –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É
- –û–±–Ω–æ–≤–ª—è–µ—Ç –≤–µ—Ä—Å–∏—é –ë–î

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π

```bash
alembic current  # –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ë–î
alembic history  # –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
```

---

## üéØ –°–ø–æ—Å–æ–± 3: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL (–¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö)

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –ë–î

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
psql -U username -d database_name

# –ò–ª–∏ —á–µ—Ä–µ–∑ Railway CLI
railway connect postgres
```

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏ SQL –∫–æ–º–∞–Ω–¥—É

```sql
ALTER TABLE dictations 
ADD COLUMN IF NOT EXISTS title_translations_json TEXT;

COMMENT ON COLUMN dictations.title_translations_json IS 
'JSON –æ–±—ä–µ–∫—Ç —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏. –§–æ—Ä–º–∞—Ç: {"en": "Title", "ru": "–ó–∞–≥–æ–ª–æ–≤–æ–∫", "uk": "–ó–∞–≥–æ–ª–æ–≤–æ–∫"}';
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'dictations' 
AND column_name = 'title_translations_json';
```

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞?

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Python

```python
from helpers.db import get_db_connection

conn = get_db_connection()
cursor = conn.cursor()

cursor.execute("""
    SELECT column_name, data_type 
    FROM information_schema.columns 
    WHERE table_name = 'dictations' 
    AND column_name = 'title_translations_json'
""")

result = cursor.fetchone()
if result:
    print(f"‚úÖ –ü–æ–ª–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {result}")
else:
    print("‚ùå –ü–æ–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")

cursor.close()
conn.close()
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ SQL

```sql
\d dictations  -- –í psql –ø–æ–∫–∞–∂–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è**: –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å–¥–µ–ª–∞–π –±—ç–∫–∞–ø –ë–î
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
3. **–û—Ç–∫–∞—Ç**: –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ `alembic downgrade -1`

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –û—à–∏–±–∫–∞: "column already exists"
–ü–æ–ª–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ, –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ SQL.

### –û—à–∏–±–∫–∞: "relation dictations does not exist"
–¢–∞–±–ª–∏—Ü–∞ `dictations` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ù—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é `55fecf84b31a`.

### –û—à–∏–±–∫–∞: "permission denied"
–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã. –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ `ALTER TABLE`.

---

## üìù –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:
1. ‚úÖ –ü–æ–ª–µ `title_translations_json` –±—É–¥–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `dictations`
2. ‚úÖ –ö–æ–¥ —É–∂–µ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é (—Å–º. `helpers/db_dictations.py`)
3. ‚úÖ –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –ë–î
4. ‚úÖ –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∏–∫—Ç–∞–Ω—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥—ã –±—É–¥—É—Ç —á–∏—Ç–∞—Ç—å—Å—è –∏–∑ –ë–î

---

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
alembic current

# –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏"
```

