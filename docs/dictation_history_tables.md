# üìä –¢–∞–±–ª–∏—Ü—ã –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤

> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–∏–∫—Ç–∞–Ω—Ç–∞–º–∏

---

## üìã –û–±–∑–æ—Ä —Ç–∞–±–ª–∏—Ü

–°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:

1. **history_activity** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é
2. **history_successes** - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—Ö–æ–≤ –ø–æ –¥–∏–∫—Ç–∞–Ω—Ç—É
3. **history_unclosed_dictations** - –¥–∞–Ω–Ω—ã–µ –æ –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –¥–∏–∫—Ç–∞–Ω—Ç–∞—Ö
4. **history_unclosed_dictations_sentences** - –¥–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### 1. `history_activity`

–î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é.

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (perfect, corrected, audio) —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é –∏ –≤—Ä–µ–º–µ–Ω–∏.

**–ü–æ–ª—è:**
- `id` (INTEGER, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id` (INTEGER, FK ‚Üí users.id) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `dictation_id` (INTEGER, FK ‚Üí dictations.id) - ID –¥–∏–∫—Ç–∞–Ω—Ç–∞
- `sentence_key` (VARCHAR(50), NULL) - –∫–ª—é—á –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (000, 001 –∏ —Ç.–¥.), –º–æ–∂–µ—Ç –±—ã—Ç—å NULL –¥–ª—è –æ–±—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `type_activity` (VARCHAR(20)) - —Ç–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: `perfect`, `corrected`, `audio`
- `number` (INTEGER, NULL, default=1) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤)
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π date –∏ time)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_history_activity_user_dictation` - –ø–æ (user_id, dictation_id)
- `idx_history_activity_created_at` - –ø–æ created_at
- `idx_history_activity_type` - –ø–æ type_activity

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –î–∞—Ç–∞ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ `created_at` —á–µ—Ä–µ–∑ `DATE(created_at)`
- –í—Ä–µ–º—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ `created_at` —á–µ—Ä–µ–∑ `EXTRACT(EPOCH FROM created_at)`
- –ü–æ–ª–µ `number` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç —É–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

### 2. `history_successes`

–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—Ö–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –¥–∏–∫—Ç–∞–Ω—Ç—É.

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–∏–∫—Ç–∞–Ω—Ç—É (—Å–∫–æ–ª—å–∫–æ perfect, corrected, audio –≤—Å–µ–≥–æ).

**–ü–æ–ª—è:**
- `id` (INTEGER, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id` (INTEGER, FK ‚Üí users.id) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `dictation_id` (INTEGER, FK ‚Üí dictations.id) - ID –¥–∏–∫—Ç–∞–Ω—Ç–∞
- `type_activity_perfect` (INTEGER, default=0) - —á–∏—Å–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –Ω–∞ –∑–≤–µ–∑–¥—É
- `type_activity_corrected` (INTEGER, default=0) - —á–∏—Å–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–ª—É–∑–≤–µ–∑–¥—É
- `type_activity_audio` (INTEGER, default=0) - —á–∏—Å–ª–æ –∑–∞—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –∞—É–¥–∏–æ
- `time_ms` (BIGINT, default=0) - –≤—Ä–µ–º—è –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `updated_at` (TIMESTAMP) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `uq_history_successes_user_dictation` - —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ (user_id, dictation_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_history_successes_user_dictation` - –ø–æ (user_id, dictation_id)
- `idx_history_successes_created_at` - –ø–æ created_at

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∏–∫—Ç–∞–Ω—Ç
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

---

### 3. `history_unclosed_dictations`

–î–∞–Ω–Ω—ã–µ –æ –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –¥–∏–∫—Ç–∞–Ω—Ç–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

**–ü–æ–ª—è:**
- `id` (INTEGER, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id` (INTEGER, FK ‚Üí users.id) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `dictation_id` (INTEGER, FK ‚Üí dictations.id) - ID –¥–∏–∫—Ç–∞–Ω—Ç–∞
- `time_ms` (BIGINT, default=0) - –≤—Ä–µ–º—è –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
- `audio_settings_json` (TEXT, NULL) - JSON —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞—É–¥–∏–æ:
  ```json
  {
    "start": "oto",
    "typo": "ot", 
    "success": "to",
    "order": "mixed|direct",
    "repeats": 3
  }
  ```
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –¥–∏–∫—Ç–∞–Ω—Ç–æ–º
- `updated_at` (TIMESTAMP) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `uq_unclosed_user_dictation` - —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ (user_id, dictation_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_unclosed_user_dictation` - –ø–æ (user_id, dictation_id)
- `idx_unclosed_updated_at` - –ø–æ updated_at

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ó–∞–ø–∏—Å–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `users.remember_unfinished_dictations = true` –∏–ª–∏ `dictations.remember_unfinished_dictations = true`
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞ –∑–∞–ø–∏—Å—å —É–¥–∞–ª—è–µ—Ç—Å—è
- –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ "—Ö–≤–æ—Å—Ç–æ–≤" –∏ –æ–Ω–∏ —É–¥–∞–ª—è—é—Ç—Å—è, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞

---

### 4. `history_unclosed_dictations_sentences`

–î–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤.

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω–æ–≥–æ –¥–∏–∫—Ç–∞–Ω—Ç–∞.

**–ü–æ–ª—è:**
- `id` (INTEGER, PK) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id` (INTEGER, FK ‚Üí users.id) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `dictation_id` (INTEGER, FK ‚Üí dictations.id) - ID –¥–∏–∫—Ç–∞–Ω—Ç–∞
- `sentence_key` (VARCHAR(50)) - –∫–ª—é—á –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (000, 001 –∏ —Ç.–¥.)
- `type_activity_perfect` (INTEGER, default=0) - —á–∏—Å–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –Ω–∞ –∑–≤–µ–∑–¥—É
- `type_activity_corrected` (INTEGER, default=0) - —á–∏—Å–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–ª—É–∑–≤–µ–∑–¥—É
- `type_activity_audio` (INTEGER, default=0) - —á–∏—Å–ª–æ –∑–∞—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –∞—É–¥–∏–æ
- `checked` (BOOLEAN, default=false) - –≤—ã–±—Ä–∞–Ω–æ –ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `updated_at` (TIMESTAMP) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `uq_unclosed_sentences_user_dictation_key` - —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ç—Ä–æ–π–∫–∞ (user_id, dictation_id, sentence_key)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_unclosed_sentences_user_dictation` - –ø–æ (user_id, dictation_id)
- `idx_unclosed_sentences_key` - –ø–æ sentence_key

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é (user_id, dictation_id, sentence_key)
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞ –≤—Å–µ –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª—è—é—Ç—Å—è

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞

### –ü–æ–ª–µ `remember_unfinished_dictations`

–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã:

1. **users.remember_unfinished_dictations** (BOOLEAN, default=false)
   - –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ï—Å–ª–∏ `true` - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤

2. **dictations.remember_unfinished_dictations** (BOOLEAN, NULL)
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–∏–∫—Ç–∞–Ω—Ç–∞ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ users)
   - –ï—Å–ª–∏ `NULL` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ï—Å–ª–∏ `true` - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è —ç—Ç–æ–≥–æ –¥–∏–∫—Ç–∞–Ω—Ç–∞
   - –ï—Å–ª–∏ `false` - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è —ç—Ç–æ–≥–æ –¥–∏–∫—Ç–∞–Ω—Ç–∞

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
- –ï—Å–ª–∏ `users.remember_unfinished_dictations = false` –ò `dictations.remember_unfinished_dictations != true` ‚Üí –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
- –ï—Å–ª–∏ `users.remember_unfinished_dictations = true` –ò–õ–ò `dictations.remember_unfinished_dictations = true` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
- –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ "—Ö–≤–æ—Å—Ç–æ–≤" –∏ —É–¥–∞–ª—è—Ç—å –∏—Ö, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

1. **–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∏–∫—Ç–∞–Ω—Ç–æ–º:**
   - –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (perfect, corrected, audio) –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `history_activity`
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `history_successes`
   - –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤:
     - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è/—Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `history_unclosed_dictations`
     - –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ `history_unclosed_dictations_sentences`

2. **–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –¥–∏–∫—Ç–∞–Ω—Ç–∞:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `remember_unfinished_dictations`
   - –ï—Å–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–æ - —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `history_unclosed_dictations` –∏ `history_unclosed_dictations_sentences`
   - –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ - –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

3. **–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞:**
   - –í—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `history_unclosed_dictations` –∏ `history_unclosed_dictations_sentences` —É–¥–∞–ª—è—é—Ç—Å—è
   - –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ `history_successes` –∏ `history_activity`

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

1. **–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `history_unclosed_dictations`
   - –ï—Å–ª–∏ –µ—Å—Ç—å - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ –∏ –≤—Ä–µ–º—è
   - –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ `history_unclosed_dictations_sentences`
   - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–Ω—å

```sql
SELECT 
    DATE(created_at) as date,
    type_activity,
    COUNT(*) as count
FROM history_activity
WHERE user_id = ? 
  AND dictation_id = ?
  AND DATE(created_at) = CURRENT_DATE
GROUP BY DATE(created_at), type_activity;
```

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É—Å–ø–µ—Ö–æ–≤

```sql
SELECT 
    type_activity_perfect,
    type_activity_corrected,
    type_activity_audio,
    time_ms
FROM history_successes
WHERE user_id = ? AND dictation_id = ?;
```

### –ü–æ–ª—É—á–∏—Ç—å –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–µ –¥–∏–∫—Ç–∞–Ω—Ç—ã

```sql
SELECT 
    d.id,
    d.title,
    hud.time_ms,
    hud.audio_settings_json,
    hud.updated_at
FROM history_unclosed_dictations hud
JOIN dictations d ON d.id = hud.dictation_id
WHERE hud.user_id = ?
ORDER BY hud.updated_at DESC;
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º

```sql
SELECT 
    sentence_key,
    type_activity_perfect,
    type_activity_corrected,
    type_activity_audio,
    checked
FROM history_unclosed_dictations_sentences
WHERE user_id = ? AND dictation_id = ?
ORDER BY sentence_key;
```

---

## üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞

```sql
-- –£–¥–∞–ª—è–µ–º –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–π –¥–∏–∫—Ç–∞–Ω—Ç
DELETE FROM history_unclosed_dictations
WHERE user_id = ? AND dictation_id = ?;

-- –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω–æ–≥–æ –¥–∏–∫—Ç–∞–Ω—Ç–∞
DELETE FROM history_unclosed_dictations_sentences
WHERE user_id = ? AND dictation_id = ?;
```

### –£–¥–∞–ª–µ–Ω–∏–µ "—Ö–≤–æ—Å—Ç–æ–≤" –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

```sql
-- –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–µ –¥–∏–∫—Ç–∞–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE FROM history_unclosed_dictations_sentences
WHERE user_id = ? 
  AND dictation_id IN (
    SELECT dictation_id 
    FROM history_unclosed_dictations 
    WHERE user_id = ?
  );

DELETE FROM history_unclosed_dictations
WHERE user_id = ?;
```

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `created_at` –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π `date` –∏ `time`, —Ç–∞–∫ –∫–∞–∫ PostgreSQL –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∏–∑ timestamp.

2. **–ü–æ–ª–µ `number`:** –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ –≤ `history_activity`, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç —É–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –Ω–æ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.

3. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:** –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å `ON DELETE CASCADE`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –¥–∏–∫—Ç–∞–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏.

4. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:** –í —Ç–∞–±–ª–∏—Ü–∞—Ö `history_successes` –∏ `history_unclosed_dictations` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ä—É (user_id, dictation_id), —Ç–∞–∫ –∫–∞–∫ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∏–∫—Ç–∞–Ω—Ç.

